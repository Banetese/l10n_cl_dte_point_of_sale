<?xml version="1.0" encoding="utf-8"?>
<odoo>

	<template id="boleta_no_found_layout">
		<div class="row text-center mb8">
			<div class="alert-danger">
				<h1>Boleta no encontrada!</h1>
			</div>
			<a class="btn btn-primary btn-lg fa fa-search" href="/boleta">Intentar
				nuevamente
			</a>
		</div>
	</template>

	<template id="boleta_found_layout">
		<div class="row text-center mb8">
			<div class="alert-success">
				<h1>Boleta encontrada!</h1>
			</div>
			<a class="btn btn-primary btn-lg fa fa-search" href="/boleta">Buscar
				nuevamente
			</a>
			<t t-set="report_url"
				t-value="'/download/boleta?model=%s&amp;model_id=%s' % (docs[0]._name, docs[0].id)" />
			<a class="btn btn-primary btn-lg fa fa-download" t-att-href="report_url">Descargar
				PDF
			</a>
		</div>
	</template>

	<template id="boleta_input_layout" name="Consulta Boleta Electrónica">
		<form action="/boleta" method="post" enctype="multipart/form-data">
			<div class="row">
				<input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
				<div class="text-center">
					<h3>
						<u>
							<b>
								<font class="text-black">Boleta a consultar</font>
							</b>
						</u>
					</h3>
				</div>
			</div>
			<div class="row">
				<div style="margin: auto; width: 360px;">
					<div class="col-xs-12">
						<div class="col-xs-5">
							<strong class="pull-left">Tipo:</strong>
						</div>
						<div class="col-xs-7">
							<input type="radio" name="sii_codigo" value="39" checked="True" />
							<span>Boleta Afecta</span>
							<br />
							<input type="radio" name="sii_codigo" value="41" />
							<span>Boleta Exenta</span>
						</div>
					</div>
					<div class="col-xs-12">
						<div class="col-xs-5">
							<strong class="pull-left">Boleta Nº:</strong>
							<span class="fa fa-book"></span>
						</div>
						<div class="col-xs-7">
							<input class="form-control pull-right" style="display: inline-block; width: 100%;"
								type="text" name="boleta" required="" />
						</div>
					</div>
					<div class="col-xs-12">
						<div class="col-xs-5">
							<strong class="pull-left">Fecha:</strong>
							<span class="fa fa-calendar"></span>
						</div>
						<div class="col-xs-7">
							<input class="form-control pull-right" style="display: inline-block; width: 100%;"
								type="date" name="date_invoice" required="" placeholder="yyyy-mm-dd" />
						</div>
					</div>
					<div class="col-xs-12">
						<div class="col-xs-5">
							<strong class="pull-left">Total:</strong>
							<span class="fa fa-usd"></span>
						</div>
						<div class="col-xs-7">
							<input class="form-control pull-right" style="display: inline-block; width: 100%;"
								type="number" name="amount_total" required="" />
						</div>
					</div>
					<div class="mt16 text-center col-xs-12" name="boleta_filter">
						<button class="btn btn-primary btn-lg fa fa-search">Consultar Boleta</button>
					</div>
				</div>
			</div>
		</form>
	</template>

	<template id="boleta_layout" name="Consulta Boleta Electrónica">
		<t t-call="portal.frontend_layout">
			<div class="container mt16">
				<div class="oe_structure">
				</div>
			</div>
			<div id="wrap">
				<div class="oe_structure" />
				<div class="container">
					<!-- formulario de ingreso de datos -->
					<t t-if="not print_error and not docs">
						<t t-call="l10n_cl_dte_point_of_sale.boleta_input_layout" />
					</t>
					<!-- formulario de no encontrado -->
					<t t-if="print_error">
						<t t-call="l10n_cl_dte_point_of_sale.boleta_no_found_layout" />
					</t>
					<!-- formulario de documento encontrado y opcion para descargarlo -->
					<t t-if="not print_error and docs">
						<t t-call="l10n_cl_dte_point_of_sale.boleta_found_layout" />
						<div class="row" style="background-color:gray;padding: 20px;">
							<t t-call="l10n_cl_dte_point_of_sale.boleta_report_layout" />
						</div>
					</t>
				</div>
				<div class="oe_structure" />
			</div>
		</t>
	</template>

	<template id="boleta_report_layout" name="Consulta Boleta Electrónica">
		<div
			style="margin: auto;width: 320px;background-color: white;padding: 20px;font-size: 10px;">
			<t t-foreach="docs" t-as="o">
				<t t-if="o._name == 'pos.order'">
					<t t-call="l10n_cl_dte_point_of_sale.boleta_report_body_layout" />
				</t>
				<t t-if="o._name == 'account.invoice'">
					<t t-call="l10n_cl_dte_point_of_sale.boleta_report_body_layout" />
				</t>
			</t>
		</div>
	</template>

	<template id="boleta_report_body_layout" name="Reporte Boleta Electrónica">
		<div class="page">
			<div class="row" id="header">
				<div class="col-xs-12 text-center">
					<h4>
						<span t-esc="o.company_id.partner_id.name" />
					</h4>
					<h4>
						<span t-esc="o.company_id.partner_id.document_number" />
					</h4>
				</div>
				<div class="col-xs-12 text-center">
					<h5 t-field="o.company_id.activity_description" />
				</div>
				<div class="col-xs-12 text-center">
					<h5>
						<span t-esc="o.company_id.partner_id.street" />
						<span t-esc="o.company_id.partner_id.city" />
					</h5>
				</div>
				<div class="col-xs-12 text-center" t-if="o.journal_document_class_id">
					<h5>
						<span t-field="o.journal_document_class_id.sii_document_class_id.name" />
						N°:
						<span t-field="o.sii_document_number" />
					</h5>
				</div>
			</div>
			<div id="info">
				<strong>Teléfono:</strong>
				<t t-esc="o.company_id.phone" />
				<br />
				<strong>Vendedor:</strong>
				<t t-esc="o.user_id.name" />
				<br />
				<strong>Tienda:</strong>
				<t t-esc="o.location_id.name" />
				<br />
				<strong>Fecha:</strong>
				<t t-esc="o.date_order" />
				<br />
				<br />
				<t t-if="o.partner_id">
					<strong>Cliente:</strong>
					<span t-esc="o.partner_id.name" />
					<br />
					<strong>Rut:</strong>
					<span t-esc="o.partner_id.document_number" />
					<br />
					<strong>Dirección:</strong>
					<span t-esc="o.partner_id.street" />
					<br />
					<strong>Número de identificación:</strong>
					<span t-esc="o.partner_id.id" />
					<br />
				</t>
			</div>
			<table class="table table-condensed" id="lines">
				<thead>
					<tr>
						<th>Descripción</th>
						<th class="text-right">Cantidad</th>
						<th class="text-right">Precio Unitario</th>
						<th class="text-right">Total</th>
					</tr>
				</thead>
				<tbody>
					<tr t-foreach="o.lines" t-as="line">
						<td>
							<span t-field="line.product_id" />
						</td>
						<td class="text-right">
							<t t-if="o.state != 'cancel' and o.statement_ids">
								<span t-field="line.qty" />
							</t>
						</td>
						<td class="text-right">
							<t t-if="o.state != 'cancel' and o.statement_ids">
								<span t-field="line.price_unit" widget="monetary" />
							</t>
							<t t-if="line.discount != 0.0">
								<span t-esc="line.discount" />
								%
							</t>
						</td>
						<td>
							<t t-if="o.state != 'cancel' and o.statement_ids">
								<span t-field="line.price_subtotal_incl" widget="monetary" />
							</t>
						</td>
					</tr>
				</tbody>
			</table>
			<div class="row" id="subtotal">
				<div class="col-xs-6 pull-right">
					<table class="table table-condensed">
						<tr t-if="o.exento() !=0">
							<td>Exento:</td>
							<td class="pos-right-align">
								<t t-esc="o.exento()" />
							</td>
						</tr>
						<tr>
							<td>
								<strong>MONTO TOTAL</strong>
							</td>
							<td class="text-right">
								<strong t-field="o.amount_total" widget="monetary" />
							</td>
						</tr>
					</table>
				</div>
			</div>
			<table class="table table-condensed" id="payments">
				<thead>
					<tr>
						<th>FORMAS DE PAGO</th>
						<th>Monto</th>
					</tr>
				</thead>
				<tbody>
					<tr t-foreach="o.statement_ids" t-as="p">
						<td>
							<span t-esc="p.name" />
						</td>
						<td>
							<span t-field="p.amount" />
						</td>
					</tr>
				</tbody>
			</table>
			<div class="row" t-if="o.sii_barcode_img" id="barcode">
				<div class="col-xs-12">
					<span t-field="o.sii_barcode_img" t-options="{'widget': 'image'}"
						style="width: 100%" />
				</div>
				<div class="col-xs-12">
					<p style="text-align:center;color:red; font-size:8px;">
						Timbre Electrónico SII
						<br />
						Verifique documento:
						<t
							t-esc="o.company_id.website + '/boleta/' + str(o.sii_document_number)" />
					</p>
				</div>
			</div>
		</div>
	</template>

</odoo>
